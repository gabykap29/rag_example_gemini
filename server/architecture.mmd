graph TB
    %% Cliente
    Client[ğŸŒ Cliente Web/API]
    
    %% API Layer
    subgraph API["ğŸš€ API Layer (FastAPI)"]
        GenerateEndpoint["/generate<br/>ğŸ“ Actividades Educativas"]
        StudentEndpoint["/generate/student<br/>ğŸ“ Asistente Educativo"]
        DocumentsEndpoint["/documents/upload<br/>ğŸ“„ Subida de Documentos"]
    end
    
    %% Services Layer
    subgraph Services["âš™ï¸ Services Layer"]
        GenerateService[generate_response<br/>ğŸ”„ LÃ³gica de GeneraciÃ³n]
        AssistantService[generate_response_assistant<br/>ğŸ¤– Asistente Virtual]
        DocumentsService[upload_document<br/>ğŸ“‚ Procesamiento de Docs]
    end
    
    %% Core Layer
    subgraph Core["ğŸ”§ Core Layer"]
        ModelsCore[models.py<br/>ğŸ§  LLM Integration]
        DocumentsCore[documents.py<br/>ğŸ“š GestiÃ³n de Documentos]
        VectorCore[vectorstore.py<br/>ğŸ” Vector Database]
    end
    
    %% AI Models
    subgraph AIModels["ğŸ¤– AI Models"]
        Gemini[Google Gemini 2.0<br/>ğŸŒŸ Modelo Principal]
        Ollama[Ollama<br/>ğŸ¦™ Modelo Local]
        OllamaStudent[medicina_usuario<br/>ğŸ‘¨â€ğŸ“ Modelo Estudiante]
    end
    
    %% Templates & Config
    subgraph Config["âš™ï¸ Configuration"]
        CustomTemplate[custom_template<br/>ğŸ“‹ Plantilla Educativa]
        UserTemplate[user_template<br/>ğŸ¯ Plantilla Asistente]
        ConfigFile[config.py<br/>ğŸ”§ ConfiguraciÃ³n]
        EnvFile[.env<br/>ğŸ” Variables de Entorno]
    end
    
    %% Data Storage
    subgraph Storage["ğŸ’¾ Data Storage"]
        ChromaDB[(ChromaDB<br/>ğŸ” Vector Database)]
        Documents[(Documents<br/>ğŸ“ PDF/DOCX Files)]
        Logs[(Logs<br/>ğŸ“Š Sistema de Logs)]
    end
    
    %% Utils
    subgraph Utils["ğŸ› ï¸ Utilities"]
        Filters[filters.py<br/>ğŸ§¹ Filtros de Texto]
        Logging[logging.py<br/>ğŸ“ Sistema de Logs]
        Probability[probability.py<br/>ğŸ“ˆ CÃ¡lculo de Similitud]
    end
    
    %% External Services
    subgraph External["ğŸŒ External Services"]
        GoogleAPI[Google AI API<br/>ğŸ”— Gemini Access]
        OllamaAPI[Ollama API<br/>ğŸ“¡ Local LLM Server]
    end
    
    %% Conexiones principales
    Client --> API
    
    %% API to Services
    GenerateEndpoint --> GenerateService
    StudentEndpoint --> AssistantService
    DocumentsEndpoint --> DocumentsService
    
    %% Services to Core
    GenerateService --> ModelsCore
    GenerateService --> DocumentsCore
    AssistantService --> ModelsCore
    DocumentsService --> DocumentsCore
    DocumentsService --> VectorCore
    
    %% Core to Storage and External
    ModelsCore --> AIModels
    DocumentsCore --> ChromaDB
    DocumentsCore --> Documents
    VectorCore --> ChromaDB
    
    %% AI Models to External APIs
    Gemini --> GoogleAPI
    Ollama --> OllamaAPI
    OllamaStudent --> OllamaAPI
    
    %% Configuration
    ModelsCore --> Config
    Core --> Utils
    
    %% Logging
    API --> Logs
    Services --> Logs
    Core --> Logs
    
    %% Styling
    classDef apiStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef serviceStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef coreStyle fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef aiStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef storageStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef configStyle fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef utilStyle fill:#e0f2f1,stroke:#004d40,stroke-width:2px
    classDef extStyle fill:#fafafa,stroke:#424242,stroke-width:2px
    
    class API apiStyle
    class Services serviceStyle
    class Core coreStyle
    class AIModels aiStyle
    class Storage storageStyle
    class Config configStyle
    class Utils utilStyle
    class External extStyle